<div class="account-page">
  <div class="profile-header">
    <div class="profile-info">
      <div class="profile-details">
        <h3 class="section-title">Th√¥ng tin t√†i kho·∫£n</h3>
        <div class="profile-content">
          <form [formGroup]="profileForm" class="profile-form">
            <div class="form-group flex-group">
              <div class="avatar-container">
                <img *ngIf="profileForm.get('avatar')?.value" [src]="profileForm.get('avatar')?.value" alt="Avatar" class="avatar-image">
                <input type="file" (change)="onAvatarChange($event)" style="display: none;" #avatarInput>
                <button *ngIf="isEditingProfileName" type="button" nz-button nzType="link" class="edit-avatar-button" (click)="avatarInput.click()">
                  <i class="fa fa-pencil"></i>
                </button>
              </div>
              <div class="form-field profile-name-container">
                <label for="profileName" class="profile-name-label">H·ªç t√™n ng∆∞·ªùi d√πng: </label>
                <input id="profileName" formControlName="profileName" type="text" class="profile-name-input" [readonly]="!isEditingProfileName">
              </div>
            </div>
            <button *ngIf="!isEditingProfileName" nz-button nzType="primary" class="submit-button" (click)="toggleEditProfileName()">
              Ch·ªânh s·ª≠a
            </button>
            <button *ngIf="isEditingProfileName" nz-button nzType="primary" class="submit-button" (click)="saveProfileName()">
              L∆∞u th√¥ng tin
            </button>
            <button *ngIf="isEditingProfileName" nz-button nzType="default" class="cancel-button" (click)="cancelEdit()">
              H·ªßy
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div class="login-info">
    <h3 class="section-title">T√†i kho·∫£n ƒëƒÉng nh·∫≠p</h3>
    <div class="login-details">
      <p>Email: <span class="info-value">{{ profileForm.get('email')?.value }}</span>
        <a class="info-link" (click)="openChangePasswordModal()">THAY ƒê·ªîI M·∫¨T KH·∫®U</a>
      </p>
    </div>
  </div>

  <!-- Change Password Modal -->
  <nz-modal [(nzVisible)]="isChangePasswordModalVisible" nzTitle="ƒê·ªïi m·∫≠t kh·∫©u" (nzOnCancel)="handleCancel()" (nzOnOk)="handlePasswordChange()" [nzOkDisabled]="!isPasswordFormValid">
    <ng-container *nzModalContent>
      <form [formGroup]="passwordChangeForm">
        <div class="form-group">
          <label for="oldPassword">Nh·∫≠p m·∫≠t kh·∫©u c≈©:</label>
          <div class="password-input-container">
            <input id="oldPassword" formControlName="oldPassword" [type]="passwordTypeOld" nz-input />
            <button type="button" (mousedown)="showPassword('old')" (mouseup)="hidePassword('old')" (mouseleave)="hidePassword('old')">üëÅÔ∏è</button>
          </div>
        </div>
        <div class="form-group">
          <label for="newPassword">Nh·∫≠p m·∫≠t kh·∫©u m·ªõi:</label>
          <div class="password-input-container">
            <input id="newPassword" formControlName="newPassword" [type]="passwordTypeNew" nz-input />
            <button type="button" (mousedown)="showPassword('new')" (mouseup)="hidePassword('new')" (mouseleave)="hidePassword('new')">üëÅÔ∏è</button>
          </div>
          <div *ngIf="passwordChangeForm.get('newPassword')?.touched && passwordChangeForm.get('newPassword')?.errors?.['weakPassword']" class="error-message">
            M·∫≠t kh·∫©u m·ªõi ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª± bao g·ªìm 1 ch·ªØ hoa, 1 ch·ªØ th∆∞·ªùng v√† 1 k√Ω t·ª± ƒë·∫∑c bi·ªát.
          </div>
        </div>
        <div class="form-group">
          <label for="confirmNewPassword">Nh·∫≠p l·∫°i m·∫≠t kh·∫©u m·ªõi:</label>
          <div class="password-input-container">
            <input id="confirmNewPassword" formControlName="confirmPassword" [type]="passwordTypeConfirm" nz-input />
            <button type="button" (mousedown)="showPassword('confirm')" (mouseup)="hidePassword('confirm')" (mouseleave)="hidePassword('confirm')">üëÅÔ∏è</button>
          </div>
          <div *ngIf="passwordChangeForm.errors?.['mismatch']" class="error-message">
            M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng kh·ªõp.
          </div>
        </div>
      </form>
    </ng-container>
  </nz-modal>
</div>